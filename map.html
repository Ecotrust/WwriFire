<html>
<head>
    <title> Wax/Modest Maps Demo</title>
    <script src='wax/ext/modestmaps.min.js' type='text/javascript'></script>
    <script src='wax/dist/wax.mm.js' type='text/javascript'></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js" type="text/javascript"></script>
    <link href='wax/theme/controls.css' rel='stylesheet' type='text/css' />
    <link href='css/site.css' rel='stylesheet' type='text/css' />
</head>
<body>
    <!-- 
    Divs for custom callbacks
    <div class="info"><h2>Mouse Over</h2><div id="info1"> </div></div>
    <div class="info"><h2>Click</h2><div id="info2"> </div></div>
    -->
    <div id="themap"> 
        <div class='wax-legends'><div class='wax-legend'><img src="img/wwri_legend.png" /></div></div>
        <a class='share button' href="#">Share</a>
        <a class='explore button' href="#">Explore</a>
        <div id="share-popup" style="display:none;" class="wax-popup wax-tooltip">
            <h1>Share this Map</h1>
            <p> Twitter, Facebook, link, etc. </p>
            <a href="#" class="close myclose"></a>
        </div>
        <div id="explore-popup" style="display:none;" class="wax-popup wax-tooltip">
            <h1>Explore the Map</h1>
            <p> Map details, data downloads, metadata, etc. </p>
            <a href="#" class="close myclose"></a>
        </div>
    </div>
    <script>
        //var layername = '2004_Election_Data';
        var layername = 'wwri_mp3';
        var tilejson = {
            tilejson: '1.0.0',
            scheme: 'tms',
            tiles: ['http://tilestream.labs.ecotrust.org/1.0.0/'+ layername +'/{z}/{x}/{y}.png']
        };

        // Alias com.modestmaps to mm. This isn't necessary -
        var mm = com.modestmaps;

        // Set up a map in a div with the id 'modestmaps-setup'
        var m = new mm.Map('themap',
            new wax.mm.connector(tilejson),
            new mm.Point(800,500)
        );

        // Currently MM doesn't support setting restricted extents or zoom levels 
        // Ticket => https://github.com/stamen/modestmaps-js/issues/57
        // The workaround is painful and should really be part of the core lib
        // Workaround => https://gist.github.com/1248897, http://bl.ocks.org/1248897

        // Hash URLs?
        // wax.mm.hash(m);

        /* Use this for custom callbacks
        var interaction_options = {
            callbacks: {
                over: function (feature, context) { 
                    // feature = html template
                    // context = html div element
                    $('#info1').html(feature);
                },
                out: function () { 
                    $('#info1').html('');
                },
                click: function (feature, context) { 
                    $('#info2').html(feature);
                },
            }
        };
        wax.mm.interaction(m, tilejson, interaction_options);
        */
        wax.mm.interaction(m, tilejson);

        var fullscreen = wax.mm.fullscreen(m, tilejson); //.appendTo(m.parent);
        fullscreen.full()

        wax.mm.attribution(m, tilejson).appendTo(m.parent);

        z = wax.mm.zoomer(m, tilejson); 
        z.appendTo(m.parent);

        //wax.mm.legend(m, tilejson).appendTo(m.parent);

        m.setCenterZoom(new mm.Location(45.5, -120.4), 6);

        $('.share').click( function(e) {
            $('#share-popup').show();
            e.preventDefault();
        });
        $('.explore').click( function(e) {
            $('#explore-popup').show();
            e.preventDefault();
        });
        $('.myclose').live( 'click', function(e) {
            $('#share-popup').hide();
            $('#explore-popup').hide();
            e.preventDefault();
        });


        // We need a way to stop clicks from passing through popups
        // Currently no way to do this that I can tell...
        // See https://github.com/mapbox/wax/issues/65
    </script>

</body>
</html>
