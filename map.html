<html>
<head>
    <title> Wax/Modest Maps Demo</title>
    <script src='wax/ext/modestmaps.min.js' type='text/javascript'></script>
    <script src='wax/dist/wax.mm.js' type='text/javascript'></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js" type="text/javascript"></script>
    <link href='wax/theme/controls.css' rel='stylesheet' type='text/css' />
    <link href='css/ecotrust.css' rel='stylesheet' type='text/css' />
    <link href='css/site.css' rel='stylesheet' type='text/css' />
</head>
<body>
    <!-- 
    Divs for custom callbacks
    <div class="info"><h2>Mouse Over</h2><div id="info1"> </div></div>
    <div class="info"><h2>Click</h2><div id="info2"> </div></div>
    -->
    <div id="themap"> 
        <div class='wax-legends'><div class='wax-legend'><img src="img/wwri_legend.png" /></div></div>
        <a class='share button' href="#">Share</a>
        <a class='explore button' href="#">Source</a>
        <div id="share-popup" style="display:none;" class="share-popup wax-tooltip">
	  <h1>Share this Map</h1>
	  <!-- AddThis Button BEGIN -->
	  <div class="addthis_toolbox addthis_default_style ">
	    <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	    <a class="addthis_button_tweet"></a>
	    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	    <a class="addthis_counter addthis_pill_style"></a>
	    <a href="#" class="close myclose"></a>
	  </div>
	  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=xa-4eea80e04fbb2110"></script>
	<!-- AddThis Button END -->
        </div>
        <div id="explore-popup" style="display:none;" class="wax-popup wax-tooltip">
	    <h1>Map Details</h1>
        <h2>Projects:</h2>
        <p>Whole Watershed Restoration Initiative (WWRI) project points and statuses.</p>
	    <table>
            <tr>
                <td><img src="img/download.png" /></td>
                <td> Download: </td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3Awwri&outputFormat=csv&request=GetFeature&service=WFS">CSV</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3Awwri&outputFormat=excel&request=GetFeature&service=WFS">Excel</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wms/kml?layers=geonode%3Awwri&mode=download">KML</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geonetwork/srv/en/csw?outputschema=http%3A%2F%2Fwww.isotc211.org%2F2005%2Fgmd&service=CSW&request=GetRecordById&version=2.0.2&elementsetname=full&id=62ca1b36-0594-11e1-aa6d-000c295c828d" target="_blank">Metadata</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/data/geonode:wwri" target="_blank">More</a></td>
            </tr>
        </table>
        <h2>Watersheds:</h2>
        <p>WWRI Watershed data.</p>
        <table>
            <tr>
                <td><img src="img/download.png" /></td>
                <td> Download: </td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3AWWRI_FWshd_20101008&outputFormat=csv&request=GetFeature&service=WFS">CSV</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3AWWRI_FWshd_20101008&outputFormat=excel&request=GetFeature&service=WFS">Excel</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wms/kml?layers=geonode%3AWWRI_FWshd_20101008&mode=download">KML</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geonetwork/srv/en/csw?outputschema=http%3A%2F%2Fwww.isotc211.org%2F2005%2Fgmd&service=CSW&request=GetRecordById&version=2.0.2&elementsetname=full&id=6cf930fe-059b-11e1-863c-000c295c828d" target="_blank">Metadata</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/data/geonode:WWRI_FWshd_20101008" target="_blank">More</a></td>
            </tr>
        </table>
        <h2>Basins:</h2>
        <p>WWRI Basin data.</p>
        <table>
            <tr>
                <td><img src="img/download.png" /></td>
                <td> Download: </td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3AWWRI_Pbasins_20101008&outputFormat=csv&request=GetFeature&service=WFS">CSV</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wfs?typename=geonode%3AWWRI_Pbasins_20101008&outputFormat=excel&request=GetFeature&service=WFS">Excel</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geoserver-geonode-dev/wms/kml?layers=geonode%3AWWRI_Pbasins_20101008&mode=download">KML</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/geonetwork/srv/en/csw?outputschema=http%3A%2F%2Fwww.isotc211.org%2F2005%2Fgmd&service=CSW&request=GetRecordById&version=2.0.2&elementsetname=full&id=c5ba48d4-059d-11e1-9bdd-000c295c828d" target="_blank">Metadata</a> |</td>
                <td><a href="http://geonode.labs.ecotrust.org/data/geonode:WWRI_Pbasins_20101008" target="_blank">More</a></td>
            </tr>
	    </table>

	    <a href="#" class="close myclose"></a>
        </div>
    </div>
    <script>
        //var layername = '2004_Election_Data';
        var layername = 'wwri_mp3';
        var tilejson = {
            tilejson: '1.0.0',
            scheme: 'tms',
            tiles: ['http://tilestream.labs.ecotrust.org/1.0.0/'+ layername +'/{z}/{x}/{y}.png']
        };

        // Alias com.modestmaps to mm. This isn't necessary -
        var mm = com.modestmaps;

        // Set up a map in a div with the id 'modestmaps-setup'
        var m = new mm.Map('themap',
            new wax.mm.connector(tilejson),
            new mm.Point(800,500)
        );

        // Currently MM doesn't support setting restricted extents or zoom levels 
        // Ticket => https://github.com/stamen/modestmaps-js/issues/57
        // The workaround is painful and should really be part of the core lib
        // Workaround => https://gist.github.com/1248897, http://bl.ocks.org/1248897

        // Hash URLs?
        // wax.mm.hash(m);

        /* Use this for custom callbacks
        var interaction_options = {
            callbacks: {
                over: function (feature, context) { 
                    // feature = html template
                    // context = html div element
                    $('#info1').html(feature);
                },
                out: function () { 
                    $('#info1').html('');
                },
                click: function (feature, context) { 
                    $('#info2').html(feature);
                },
            }
        };
        wax.mm.interaction(m, tilejson, interaction_options);
        */
        wax.mm.interaction(m, tilejson);

        var fullscreen = wax.mm.fullscreen(m, tilejson); //.appendTo(m.parent);
        fullscreen.full()

        wax.mm.attribution(m, tilejson).appendTo(m.parent);

        z = wax.mm.zoomer(m, tilejson); 
        z.appendTo(m.parent);

        //wax.mm.legend(m, tilejson).appendTo(m.parent);

        m.setCenterZoom(new mm.Location(45.5, -120.4), 6);

        $('.share').click( function(e) {
            $('#share-popup').show();
            e.preventDefault();
        });
        $('.explore').click( function(e) {
            $('#explore-popup').show();
            e.preventDefault();
        });
        $('.myclose').live( 'click', function(e) {
            $('#share-popup').hide();
            $('#explore-popup').hide();
            e.preventDefault();
        });


        // We need a way to stop clicks from passing through popups
        // Currently no way to do this that I can tell...
        // See https://github.com/mapbox/wax/issues/65
    </script>

</body>
</html>
